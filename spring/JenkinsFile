pipeline {
    agent any
    
    stages {
        stage('Test Repository Checkout') {
            steps {
                echo 'Repository checkout successful!'
                bat 'dir'
                echo 'Files in current directory listed above'
            }
        }
        
        stage('Check Java and Maven') {
            steps {
                echo 'Testing Java...'
                script {
                    try {
                        bat 'java -version'
                        echo '✅ Java is working'
                    } catch (Exception e) {
                        echo '❌ Java not found or not configured'
                    }
                }
                
                echo 'Testing Maven...'
                script {
                    try {
                        bat 'mvn -version'
                        echo '✅ Maven is working'
                    } catch (Exception e) {
                        echo '❌ Maven not found or not configured'
                    }
                }
            }
        }
        
        stage('Check Project Files') {
            steps {
                echo 'Looking for project files...'
                script {
                    if (fileExists('pom.xml')) {
                        echo '✅ pom.xml found'
                        bat 'type pom.xml'
                    } else {
                        echo '❌ pom.xml not found'
                        bat 'dir /s pom.xml'
                    }
                    
                    if (fileExists('src')) {
                        echo '✅ src directory found'
                        bat 'dir src /s'
                    } else {
                        echo '❌ src directory not found'
                    }
                }
            }
        }
        
        stage('Test Maven Build') {
            steps {
                echo 'Testing Maven clean...'
                script {
                    try {
                        bat 'mvn clean'
                        echo '✅ Maven clean successful'
                    } catch (Exception e) {
                        echo "❌ Maven clean failed: ${e.getMessage()}"
                    }
                }
            }
        }
    }
    
    post {
        always {
            echo 'Test pipeline completed!'
        }
        success {
            echo '✅ All tests passed! Ready for full deployment.'
        }
        failure {
            echo '❌ Some tests failed. Check Jenkins configuration.'
        }
    }
}
