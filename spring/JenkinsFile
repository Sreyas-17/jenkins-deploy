pipeline {
    agent any
    
    stages {
        stage('Build') {
            steps {
                bat '''
                    cd spring
                    echo Building Spring Boot application...
                    mvn clean package -DskipTests -q
                    echo Build completed!
                    dir target\\*.jar
                '''
            }
        }
        
        stage('Deploy') {
            steps {
                bat '''
                    cd spring
                    echo Starting application...
                    start /B java -jar target\\spring-0.0.1-SNAPSHOT.jar
                    echo Application startup initiated!
                '''
            }
        }
        
        stage('Wait and Test') {
            steps {
                bat '''
                    echo Waiting for application to start...
                    ping 127.0.0.1 -n 16 > nul
                    echo Testing application...
                    curl http://localhost:8080/greeting || echo App might still be starting
                    echo Pipeline completed!
                '''
            }
        }
    }
    
    post {
        always {
            echo 'Build finished! Check http://localhost:8080/greeting'
        }
    }
}
